<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Overcooked Human-AI Equilibrium Study</title>
  <style>
    :root{
      --brand:#2563eb; --bg:#f7f7f7; --card:#ffffff; --muted:#6b7280; --ok:#16a34a; --warn:#f59e0b; --danger:#dc2626;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      background-color:var(--bg);
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      color:#111827; margin:0; padding:24px;
    }
    h1,h2{margin:0 0 12px}
    h3{margin:8px 0}
    .container{max-width:980px; margin:0 auto}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 10px 24px rgba(0,0,0,0.08);
      padding:22px; margin:18px 0;
    }
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .col{flex:1 1 260px}
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 18px; cursor:pointer; font-weight:600;
      background:var(--brand); color:white; transition:transform .02s ease, box-shadow .2s ease; box-shadow:0 6px 16px rgba(37,99,235,.2)
    }
    .btn[disabled]{opacity:.5; cursor:not-allowed; box-shadow:none}
    .btn.secondary{background:#111827;color:white}
    .btn.ghost{background:#eef2ff; color:#1e3a8a}
    .btn.success{background:var(--ok)}
    .btn.warn{background:var(--warn); color:#1f2937}
    .btn.danger{background:var(--danger)}
    .muted{color:var(--muted)}
    .input, select{
      width:100%; padding:12px 14px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; outline:none
    }
    label{display:block; font-weight:600; margin-bottom:8px}
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:#eef2ff; color:#1e3a8a; border-radius:999px; font-size:13px; font-weight:600
    }
    .progress{
      height:10px; width:100%; background:#e5e7eb; border-radius:999px; overflow:hidden
    }
    .progress > div{
      height:100%; width:0%; background:linear-gradient(90deg, #60a5fa, #2563eb); transition:width .3s ease
    }
    .roles{display:grid; grid-template-columns:repeat(2,minmax(260px,1fr)); gap:12px}
    .role-item{
      border:1px solid #e5e7eb; border-radius:12px; padding:12px; display:flex; align-items:flex-start; gap:10px; background:#fff
    }
    .role-item.used{opacity:.45; background:#f9fafb}
    .role-item input{margin-top:4px}
    .legend img{height:26px; vertical-align:middle}
    .inline{display:flex; align-items:center; gap:10px; flex-wrap:wrap}

    /* --- RESPONSIVE GAME CANVAS STYLES (UPDATED) --- */
    .game-viewport {
      width: 100%;              /* Take up full available width on mobile */
      max-width: 600px;         /* Stop growing at 600px on desktop */
      aspect-ratio: 1 / 1;      /* Force a perfect square shape (5x5 grid) */
      margin: 0 auto 20px;      /* Center horizontally */
      position: relative;
    }

    canvas#gameCanvas, 
    canvas#gameCanvas_practice,
    canvas#gameCanvas_pretask1,
    canvas#gameCanvas_pretask2 {
      width: 100% !important;   /* Force width to match container */
      height: 100% !important;  /* Force height to match container */
      border: 2px solid #111827; 
      display: block;
      border-radius: 8px;       
      object-fit: contain;
    }

    .game-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    /* ------------------------------------------------ */

    #stepCounter{
      font-weight:700; padding:10px 14px; border:2px solid var(--brand); border-radius:10px; display:inline-block; color:var(--brand); background:#f0f7ff
    }
    .question-scale{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .question-scale label{font-weight:500}
    .center{text-align:center}
    .hidden{display:none!important}
    .hr{height:1px; background:#e5e7eb; margin:14px 0}

    /* Scenario + Task Description styles */
    #scenarioDescription{
      background-color:#fff9e6;
      border-left:6px solid #f0ad4e;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
      padding:20px 25px;
      margin:16px 0;
      color:#333;
      line-height:1.6;
    }
    #scenarioDescription h2{margin:0 0 8px; color:#b45309}
    #scenarioDescription ul{margin:8px 0 0 18px}

    #taskDescription{
      background-color:#f9f9f9;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
      padding:20px 25px;
      margin:16px 0;
      line-height:1.6;
    }
    #taskDescription img#taskIllustration{
      display:block; margin:14px auto; max-width:100%; border:1px solid #e5e7eb; border-radius:8px;
    }
    #agentLegend{ text-align:center; margin-top:8px; color:#444 }
    #agentLegend img{ width:50px; vertical-align:middle; margin:0 10px }

    /* 7 ÁÇπÊùéÂÖãÁâπÈáèË°®Ôºö‰∏äÈù¢‰∏ÄÊéí radioÔºå‰∏ãÈù¢‰∏ÄÊéíÊñáÂ≠ó */
    .likert-7{
      display:grid;
      grid-template-columns:repeat(7, 1fr);
      grid-auto-rows:auto;
      gap:6px 12px;              /* Ë°åÈó¥Ë∑ù, ÂàóÈó¥Ë∑ù */
      align-items:center;        /* Á∫µÂêëÂ±Ö‰∏≠ radio */
      justify-items:center;      /* Ê®™ÂêëÂ±Ö‰∏≠ÊØèÂàóÂÜÖÂÆπ */
      margin-top:8px;
    }
    .likert-7 input[type="radio"]{
      margin:0;                  /* ÂéªÊéâÈªòËÆ§Â§ñËæπË∑ùÔºå‰øùËØÅÂÖâÊ†áÂØπÈΩê */
    }
    .likert-7 .scale-label{
      grid-row:2;                /* Áªü‰∏ÄÊîæÂú®Á¨¨‰∫åË°å */
      font-size:12px;
      color:#666;
      text-align:center;
      line-height:1.2;
    }
    /* Êó†ÈöúÁ¢çÔºöÊääÂèØËßÜ‰∏äÁöÑ label ÈöêËóèÔºå‰ΩÜ‰ªç‰øùÁïôÂèØËØªÊÄßÔºàÁªôÊØè‰∏™ radio ‰πü‰ºöÈÖç‰∏Ä‰∏™ aria-labelÔºâ*/
    .visually-hidden{
      position:absolute!important;
      width:1px;height:1px;
      margin:-1px;border:0;padding:0;
      clip:rect(0 0 0 0);overflow:hidden;
    }

  </style>
</head>

<body>
  <div class="container">
    <h1>Overcooked Human-AI Equilibrium Study</h1>

    <!-- Page 1: Prolific + Demographics -->
    <section id="page-intro" class="card">
      <h2>Basic Information</h2>
      <p class="muted">Please fill in the following, then continue.</p>
      <div class="row">
        <div class="col">
          <label for="prolificId">Prolific ID</label>
          <input id="prolificId" class="input" placeholder="Waiting for Prolific URL..." />
          <div id="pid-hint" style="font-size:12px; color:#16a34a; margin-top:4px; display:none;">
            ‚úì Auto-detected from Prolific
          </div>
        </div>
        <div class="col">
          <label for="age">Age</label>
          <input id="age" type="number" min="18" max="99" class="input" placeholder="e.g., 28" />
        </div>
        <div class="col">
          <label for="gender">Gender</label>
          <select id="gender" class="input">
            <option value="">Please select</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
            <option>Other</option>
          </select>
        </div>
      </div>
      <div class="inline" style="margin-top:12px">
        <button id="to-consent" class="btn" disabled>Next</button>
      </div>

      <script>
        (function() {
          //URL params
          function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
          }

          //PROLIFIC_PID
          const pid = getUrlParam('PROLIFIC_PID');
          const input = document.getElementById('prolificId');
          const hint = document.getElementById('pid-hint');

          if (pid) {
            // Found it - Auto-fill
            input.value = pid; 
            input.style.backgroundColor = "#f0fdf4";
            input.style.borderColor = "#16a34a";
            hint.style.display = "block";
            input.dispatchEvent(new Event('input', { bubbles: true }));
          } else {
            // Not found - manually
            input.placeholder = "e.g., 5f9c1d2e...";
          }
        })();
      </script>
    </section>

    <!-- Page 2: Consent -->
    <section id="page-consent" class="card hidden">
      <h2>Consent Form</h2>
      <div style="max-height:240px; overflow:auto; border:1px solid #e5e7eb; border-radius:12px; padding:14px; margin:12px 0">
        <p>This study is to understand how humans work with an AI agent to finish a collaborative game: Overcooked. </p>
        <p>The study is organized by researchers from Aalto University in Finland.</p>
        <p>This study aims to understand behavior and experience in human‚ÄìAI collaboration. Participation is voluntary and you may withdraw at any time. Data will be stored anonymously and used for research only. There are no known risks; if you feel uncomfortable, you may stop immediately.</p>
        <p>By checking the box and continuing, you indicate that you have read and agree to participate.</p>
      </div>
      <div class="inline">
        <input type="checkbox" id="consentCheck">
        <label for="consentCheck" style="margin:0">I have read and agree</label>
      </div>
      <div class="inline" style="margin-top:12px">
        <button id="to-instruction" class="btn" disabled>Continue</button>
      </div>
    </section>



    <!-- Page 3a: Instruction ‚Äì How to play + Practice -->
    <section id="page-instruction-1" class="card hidden">
      <div id="taskDescription">
        <h2>Welcome to the study!</h2>
        <p>Thank you for participating in this study!</p>
        <p>
          <strong>Your task is to finish a collaborative task:</strong> together with an AI teammate, complete as many dishes as possible within 45 seconds.<br>
          The target dish is a simple <em>lettuce salad</em>, with just 4 steps:
          <ol style="margin:8px 0 0 18px">
            <li>Pick up a lettuce,</li>
            <li>Chop it on the cutting board,</li>
            <li>Place the chopped lettuce onto a plate,</li>
            <li>Deliver the plate to the serving station.</li>
          </ol>
        </p>
        <img id="taskIllustration" src="static/images/task_illustration.png" alt="Task Illustration">
        <div id="agentLegend">
          You are <img src="static/images/agent-blue.png" alt="Agent Blue">
          &nbsp;&nbsp;&nbsp;&nbsp; Your robot partner is
          <img id="robotIcon" src="static/images/agent-robot.png" alt="Agent Robot">
          <!-- or 
          <img id="robotIcon" src="static/images/agent-robot2.png" alt="Agent Robot">
          or 
          <img id="robotIcon" src="static/images/agent-robot3.png" alt="Agent Robot">
          or 
          <img id="robotIcon" src="static/images/agent-robot4.png" alt="Agent Robot">-->
        </div>

        <!-- Kitchen item legend -->
        <div id="itemLegend" style="margin-top:14px;">
          <h3 style="margin:8px 0 6px; font-size:18px;">Kitchen Items</h3>
          <div style="
            display:grid; grid-template-columns:repeat(2, minmax(0,1fr));
            gap:10px; align-items:start; font-size:14px; color:#222;">
            
            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/counter.png" alt="Counter" style="width:36px;height:36px;">
              <div>
                <strong>Counter</strong><br>
                A surface to temporarily place items. <em>You can put vegetables or plates on counters.</em>
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/FreshLettuce.png" alt="Fresh Lettuce" style="width:36px;height:36px;">
              <div>
                <strong>Lettuce</strong><br>
                Pick it up and chop it before plating.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/plate.png" alt="Plate" style="width:36px;height:36px;">
              <div>
                <strong>Plate</strong><br>
                Place chopped lettuce on a plate; you can set plates on counters.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/cutboard.png" alt="Cutting Board" style="width:36px;height:36px;">
              <div>
                <strong>Cutting Board</strong><br>
                Chop lettuce here to make it ready for plating.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/delivery.png" alt="Delivery Station" style="width:36px;height:36px;">
              <div>
                <strong>Delivery Station</strong><br>
                Deliver the completed plate here to score.
              </div>
            </div>
          </div>

          <p style="margin-top:8px; color:#374151;">
            Tip: You may temporarily place <strong>vegetables or plates</strong> on any <strong>counter</strong> to organize your workflow.
          </p>
        </div>
        
        <p style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 18px; color: #222;">
          Use your arrow keys to play.
        </p>
        <div style="text-align:center; font-size:28px; margin-top:8px;">
          ‚¨ÜÔ∏è ‚¨áÔ∏è ‚¨ÖÔ∏è ‚û°Ô∏è
        </div>
      </div>

      <div style="margin-top:20px; text-align:center;">
        <div class="game-controls">
          <button id="btnTryPractice" class="btn">
            Try One Game (In this practice, your teammate won't move)
          </button>
        </div>
        <h3 style="font-size:14px; color:#555;">
           Please press arrow keys slowly to avoid network delay.
        </h3>
        <div class="game-viewport">
           <canvas id="gameCanvas_practice" width="600" height="600"></canvas>
        </div>
      </div>

      <p id="practiceHint" class="muted center" style="margin-top:8px">
        Practice score not enough. Finish more lettuce salad to proceed.
      </p>

      <div style="margin-top:20px; text-align:center;">
        <button id="to-instruction-2" class="btn" disabled>
          Proceed to Study Instruction
        </button>
      </div>
    </section>

    <!-- Page 3b: Study Instruction + Attention Check -->
    <section id="page-instruction-2a" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #2563eb; background-color: #eff6ff; padding: 20px; border-radius: 8px;">
        <h2 style="color:#1e3a8a; margin-top:0;">PART 1: The Goal - Work Smart, Not Hard</h2>
        <p>
          You are a chef in a busy kitchen. Unlike standard games, your goal is <strong>NOT just to be fast</strong>. 
          Your goal is to get a <span style="color:#2563eb; font-weight:bold;">High Efficiency Score</span>.
        </p>
        
        <div style="background:white; padding:15px; border-radius:8px; border:1px solid #dbeafe; margin:15px 0;">
          <h3 style="margin-top:0;">How Scoring Works:</h3>
          <ul style="line-height:1.8;">
            <li><span style="color:#16a34a; font-weight:bold;">(+) Team Revenue:</span> You gain points for every dish served.</li>
            <li><span style="color:#dc2626; font-weight:bold;">(-) Energy Cost:</span> You <span style="text-decoration:underline;">LOSE points for every step YOU take</span>.</li>
          </ul>
        </div>

        <p><strong>The Dilemma:</strong></p>
        <p>A "Hero" who runs around doing everything alone will get a <span style="color:#dc2626; font-weight:bold;">LOW score</span> because they wasted too much energy.</p>
        <p><strong>Winning Strategy:</strong> Coordinate to serve dishes while taking the fewest steps possible.</p>
      </div>

      <div class="card" style="margin-top:20px; border:1px solid #e5e7eb;">
        <h3>Comprehension Check 1/3</h3>
        <p class="muted">To get a high score, I should:</p>
        <div id="quiz-q1">
          <label class="role-item">
            <input type="radio" name="q1" value="wrong"> 
            <span>Run fast and do everything myself.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q1" value="correct"> 
            <span>Serve dishes while minimizing my own movement.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q1" value="wrong"> 
            <span>Stand still and ignore the orders.</span>
          </label>
        </div>
        <p id="q1-error" class="hidden" style="color:#dc2626; margin-top:10px;">Incorrect. Remember: Movement costs money.</p>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="btn-next-2a" class="btn" disabled>Next Section</button>
      </div>
    </section>


    <section id="page-instruction-2b" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #8b5cf6; background-color: #f5f3ff; padding: 20px; border-radius: 8px;">
        <h2 style="color:#5b21b6; margin-top:0;">PART 2: The Study Structure (5 + 5)</h2>
        <p>
          You will play a total of <strong>10 Rounds</strong>. The experiment is divided into two distinct phases to test how the AI learns from you.
        </p>
        
        <div style="margin-top:15px; margin-bottom:15px;">
          <div style="background:white; padding:15px; border-radius:8px; border:2px solid #ddd6fe; margin-bottom:10px;">
            <strong style="color:#7c3aed;">Phase 1: Observation (Rounds 1-5)</strong><br>
            The AI is <strong>watching you</strong>. It records your decisions (e.g., do you prefer chopping or plating?).<br>
            <em style="color:#666;">Your Job: Play naturally and consistently so it can learn your style.</em>
          </div>

          <div style="background:white; padding:15px; border-radius:8px; border:2px solid #ddd6fe;">
            <strong style="color:#7c3aed;">Phase 2: Adaptation (Rounds 6-10)</strong><br>
            After Round 5, the AI will <strong>update itself</strong> based on what it learned about you.<br>
            <em style="color:#666;">Your Job: Notice how the AI has changed and use its new efficiency to boost your score.</em>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:20px;">
        <h3>Comprehension Check 2/3</h3>
        
        <p style="margin-bottom:8px; font-weight:600;">1. What happens after Round 5?</p>
        <div id="quiz-q2a">
          <label class="role-item">
            <input type="radio" name="q2a" value="wrong"> 
            <span>The game ends immediately.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2a" value="correct"> 
            <span>The AI updates itself to adapt to my style.</span>
          </label>
        </div>

        <p style="margin-top:20px; margin-bottom:8px; font-weight:600;">2. Why is the AI observing you in Phase 1?</p>
        <div id="quiz-q2b">
          <label class="role-item">
            <input type="radio" name="q2b" value="wrong"> 
            <span>To judge if I am a good cook.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2b" value="correct"> 
            <span>To learn my habits and match me better in Phase 2.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2b" value="wrong"> 
            <span>It is not observing me; it ignores me.</span>
          </label>
        </div>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="btn-next-2b" class="btn" disabled>Next Section</button>
      </div>
    </section>

    <section id="page-instruction-2c" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #f59e0b; background-color: #fffbeb; padding: 20px; border-radius: 8px;">
        <h2 style="color:#92400e; margin-top:0;">PART 3: Your Strategy - Find Your Equilibrium</h2>
        <p>
          There is no single "correct" role to play. Your goal is to find the strategy that feels most efficient for <strong>you</strong>.
        </p>
        
        <ul style="line-height:1.7;">
          <li><strong>Phase 1: Play Naturally.</strong> Don't feel forced to stick to a rigid role if it feels inefficient. Play in a way that balances speed and energy costs naturally. The AI needs to observe your <em>real</em> style to learn effectively.</li>
          
          <li><strong>Phase 2: Find Your Flow.</strong> When the AI updates, it might behave differently. Don't be afraid to adjust your behavior to match it. Your goal is to settle into a rhythm‚Äîan <strong>equilibrium</strong>‚Äîwhere you both work smoothly together.</li>
          
          <li><strong>You Decide the Balance:</strong> Always remember the cost of movement. You have to make the choice: <em>"Is it worth running to get that plate, or should I wait for the AI?"</em> Find the balance that maximizes your own score.</li>
        </ul>
      </div>

      <div class="card" style="margin-top:20px;">
        <h3>Final Check 3/3</h3>

        <p style="margin-bottom:8px; font-weight:600;">1. How should you play in Phase 1?</p>
        <div id="quiz-q3a">
          <label class="role-item">
            <input type="radio" name="q3a" value="wrong"> 
            <span>I must force myself to do one specific task only.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q3a" value="correct"> 
            <span>I should play naturally so the AI learns my real style.</span>
          </label>
        </div>

        <p style="margin-top:20px; margin-bottom:8px; font-weight:600;">2. To show you are reading, select "Find equilibrium".</p>
        <div id="quiz-q3b">
          <label class="role-item"><input type="radio" name="q3b" value="wrong"> Always do nothing</label>
          <label class="role-item"><input type="radio" name="q3b" value="correct"> Find equilibrium</label>
          <label class="role-item"><input type="radio" name="q3b" value="wrong"> Run around randomly</label>
        </div>

        <p id="q3-error" class="hidden" style="color:#dc2626; margin-top:10px;">Please check your answers.</p>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="start-task-1" class="btn success" disabled style="font-size:18px; padding:15px 30px;">
          I'm Ready - Start Phase 1
        </button>
      </div>
    </section>


    <!-- Phase 1-->
    <section id="page-pretask-1" class="card hidden">
      <h2>Get Ready for Phase 1: Observation</h2>
      <p class="muted">
        <strong>Rounds 1 to 5:</strong> You will play with the <strong>Base AI</strong>.
        <br>Remember: It is watching you. Play naturally so it can learn your style.
      </p>

      <div class="card" style="margin-top:8px; display:flex; align-items:center; gap:12px;">
         <b>Your Teammate:</b>
         <img id="pretask1Robot" src="static/images/agent-robot.png" alt="Robot" style="height:42px;">
         <span>(Observing...)</span>
      </div>

      <div style="margin-top:16px; text-align:center;">
        <div class="game-viewport">
           <canvas id="gameCanvas_pretask1" width="600" height="600"></canvas>
        </div>
        <p class="muted" style="margin-top:5px; font-size:14px;">Use arrow keys to practice moving before the timer starts.</p>
      </div>

      <div class="center" style="margin-top:16px;">
        <button id="btnEnterTask1" class="btn success" style="font-size:18px; padding:12px 24px;">Start Phase 1</button>
      </div>
    </section>


      <!-- Phase 1-->
    <section id="page-pretask-2" class="card hidden">
      <h2>Phase 2: AI Update Complete</h2>
      
      <div style="background-color:#f0fdf4; border-left:6px solid #22c55e; padding:15px; margin-bottom:15px;">
        <p style="margin:0; font-weight:bold; color:#15803d; font-size:18px;">
           <span style="font-size:24px;">üîÑ</span> Adaptation Successful
        </p>
        <p style="margin:5px 0 0 0;">
           The AI has processed your data from Phase 1. 
           It has now updated its strategy to match <strong>YOUR</strong> specific playstyle.
        </p>
      </div>

      <p><strong>Rounds 6 to 10:</strong> Play with the updated AI. Find your new equilibrium!</p>

      <div class="card" style="margin-top:8px; display:flex; align-items:center; gap:12px;">
         <b>Your Teammate:</b>
         <img id="pretask2Robot" src="static/images/agent-robot.png" alt="Robot" style="height:42px;">
         <span>(Adapted to You)</span>
      </div>

      <div style="margin-top:16px; text-align:center;">
        <div class="game-viewport">
           <canvas id="gameCanvas_pretask2" width="600" height="600"></canvas>
        </div>
      </div>

      <div class="center" style="margin-top:16px;">
        <button id="btnEnterTask2" class="btn success" style="font-size:18px; padding:12px 24px;">Start Phase 2</button>
      </div>
    </section>


    <section id="page-task" class="card hidden">
      <div class="inline" style="justify-content:space-between">
          <div class="inline">
          <span class="pill" id="taskTag">Phase 1</span>
          <span class="pill"><span id="roundLabel">Round 1 / 5</span></span>
          </div>
          <div id="stepCounter" style="font-weight:bold; color:#2563eb;">Steps: 0</div>
      </div>
      <div class="hr"></div>

      <div class="row" style="flex-direction: column; align-items: center;">
         <div style="width:100%; max-width:900px;">
           
           <div class="inline" style="margin-top:12px; gap:10px; justify-content:center;">
             <button id="btnPlay" class="btn success" style="font-size:20px; padding:10px 40px;">Play Round</button>
             <button id="btnRestart" class="btn ghost" disabled>Restart</button>
           </div>

           <div class="hr"></div>

           <div class="inline">
             <div id="stepsLeftDisplay">Steps Remaining: <span id="stepsLeft" style="font-weight:bold;">‚Äî</span></div>
             <p class="muted" style="font-size:14px; margin-left:15px;">(Game ends when steps reach 0)</p>
           </div>
           
           <div class="progress" style="margin-top:8px">
             <div id="roundProgress"></div>
           </div>
         </div>

         <div style="margin-top:20px; text-align:center;">
           <div class="game-viewport">
              <canvas id="gameCanvas" width="600" height="600"></canvas>
           </div>
         </div>

         <div id="round-end-panel" class="card hidden" style="margin-top:16px; width:100%; max-width:600px; border:2px solid #2563eb;">
           <h3 style="color:#1e3a8a; margin-top:0;">Round Finished!</h3>
           
           <p style="margin-bottom:10px;">How efficient did you feel in this round?</p>
           <div class="question-scale">
             <label>1<br><span style="font-size:12px;color:#666;">Chaos</span></label>
             <input type="radio" name="personaFidelity" value="1">
             <input type="radio" name="personaFidelity" value="2">
             <input type="radio" name="personaFidelity" value="3">
             <input type="radio" name="personaFidelity" value="4">
             <input type="radio" name="personaFidelity" value="5">
             <input type="radio" name="personaFidelity" value="6">
             <input type="radio" name="personaFidelity" value="7">
             <label>7<br><span style="font-size:12px;color:#666;">Perfect Flow</span></label>
           </div>

           <div class="center" style="margin-top:15px;">
             <button id="btnNext" class="btn secondary" disabled>Next Round</button>
           </div>
         </div>
      </div>
    </section>


    <section id="page-qs" class="card hidden">
      <h2 id="qsTitle">Final Debrief</h2>
      <p>You have completed both phases. Please answer a few questions about your strategy.</p>

      <div class="card" style="border-left: 4px solid #2563eb;">
        <label for="q_strategy" style="font-weight:bold; font-size:16px; display:block; margin-bottom:8px;">
          1. Describe your strategy. Did you change how you played in Phase 2 compared to Phase 1?
        </label>
        <textarea id="q_strategy" class="input" rows="4" style="width:100%;" placeholder="I noticed the AI started doing... so I decided to..."></textarea>
      </div>

      <div class="card" style="margin-top:15px;">
        <div style="font-weight:bold; margin-bottom:8px;">2. "I felt like the AI in Phase 2 understood my intentions better than Phase 1."</div>
        <div class="likert-7" role="radiogroup">
          <input type="radio" name="q_adapt" value="1">
          <input type="radio" name="q_adapt" value="2">
          <input type="radio" name="q_adapt" value="3">
          <input type="radio" name="q_adapt" value="4">
          <input type="radio" name="q_adapt" value="5">
          <input type="radio" name="q_adapt" value="6">
          <input type="radio" name="q_adapt" value="7">
          <div class="scale-label">Strongly disagree</div>
          <div class="scale-label"></div><div class="scale-label"></div>
          <div class="scale-label">Neutral</div>
          <div class="scale-label"></div><div class="scale-label"></div>
          <div class="scale-label">Strongly agree</div>
        </div>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="qsNext" class="btn success">Submit & Finish</button>
      </div>
    </section>


    <section id="page-end" class="card hidden center">
      <h2>All Done!</h2>
      <div style="font-size:48px;">üéâ</div>
      <p>Thank you for participating in our study.</p>
      
      <p class="muted" id="completionHint">Click the button below to upload your data and generate your code.</p>
      <button id="btnFinish" class="btn">Upload Data & Get Code</button>
      
      <div id="completionCodeWrap" class="hidden" style="margin-top:20px; padding:15px; background:#f0fdf4; border:1px solid #22c55e; border-radius:8px;">
        <p style="margin:0; color:#15803d;">Your Completion Code:</p>
        <p id="completionCode" style="font-weight:700; font-size:24px; margin:5px 0 0 0; letter-spacing:1px;"></p>
      </div>
    </section>

    <div style="display:none;">
       <button id="btnProceedTask2"></button>
       <button id="btnProceedTask3"></button>
       <button id="btnProceedTask4"></button>
       <button id="btnEnterTask3"></button>
       <button id="btnEnterTask4"></button>
       <canvas id="gameCanvas_pretask3"></canvas>
       <canvas id="gameCanvas_pretask4"></canvas>
       <div id="postTask1Hint"></div> <div id="postTask2Hint"></div>
       <div id="postTask3Hint"></div>
       <div id="personaInputWrap"></div> <div id="personaSelectWrap"></div>
       <input id="personaInput">
       <select id="personaSelect"></select>
       <div id="personaHistory"></div>
    </div>

  </div>

  <script src="static/js/config.js"></script>
  <script src="static/js/view.js"></script>
  <script src="static/js/controller.js"></script>
  <script src="static/js/practice.js"></script> ```
  <!-- <script src="static/js/equilibriumstudy_freeplay_4models_2rounds_samemap.js"></script> -->
</body>
</html>
