<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Overcooked Human-AI Equilibrium Study</title>
  <style>
    :root{
      --brand:#2563eb; --bg:#f7f7f7; --card:#ffffff; --muted:#6b7280; --ok:#16a34a; --warn:#f59e0b; --danger:#dc2626;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      background-color:var(--bg);
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      color:#111827; margin:0; padding:24px;
    }
    h1,h2{margin:0 0 12px}
    h3{margin:8px 0}
    .container{max-width:980px; margin:0 auto}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 10px 24px rgba(0,0,0,0.08);
      padding:22px; margin:18px 0;
    }
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .col{flex:1 1 260px}
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 18px; cursor:pointer; font-weight:600;
      background:var(--brand); color:white; transition:transform .02s ease, box-shadow .2s ease; box-shadow:0 6px 16px rgba(37,99,235,.2)
    }
    .btn[disabled]{opacity:.5; cursor:not-allowed; box-shadow:none}
    .btn.secondary{background:#111827;color:white}
    .btn.ghost{background:#eef2ff; color:#1e3a8a}
    .btn.success{background:var(--ok)}
    .btn.warn{background:var(--warn); color:#1f2937}
    .btn.danger{background:var(--danger)}
    .muted{color:var(--muted)}
    .input, select{
      width:100%; padding:12px 14px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; outline:none
    }
    label{display:block; font-weight:600; margin-bottom:8px}
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:#eef2ff; color:#1e3a8a; border-radius:999px; font-size:13px; font-weight:600
    }
    .progress{
      height:10px; width:100%; background:#e5e7eb; border-radius:999px; overflow:hidden
    }
    .progress > div{
      height:100%; width:0%; background:linear-gradient(90deg, #60a5fa, #2563eb); transition:width .3s ease
    }
    .roles{display:grid; grid-template-columns:repeat(2,minmax(260px,1fr)); gap:12px}
    .role-item{
      border:1px solid #e5e7eb; border-radius:12px; padding:12px; display:flex; align-items:flex-start; gap:10px; background:#fff
    }
    .role-item.used{opacity:.45; background:#f9fafb}
    .role-item input{margin-top:4px}
    .legend img{height:26px; vertical-align:middle}
    .inline{display:flex; align-items:center; gap:10px; flex-wrap:wrap}

    /* --- RESPONSIVE GAME CANVAS STYLES (UPDATED) --- */
    .game-viewport {
      width: 100%;              /* Take up full available width on mobile */
      max-width: 600px;         /* Stop growing at 600px on desktop */
      aspect-ratio: 1 / 1;      /* Force a perfect square shape (5x5 grid) */
      margin: 0 auto 20px;      /* Center horizontally */
      position: relative;
    }

    canvas#gameCanvas, 
    canvas#gameCanvas_practice,
    canvas#gameCanvas_pretask1,
    canvas#gameCanvas_pretask2 {
      width: 100% !important;   /* Force width to match container */
      height: 100% !important;  /* Force height to match container */
      border: 2px solid #111827; 
      display: block;
      border-radius: 8px;       
      object-fit: contain;
    }

    .game-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    /* ------------------------------------------------ */

    #stepCounter{
      font-weight:700; padding:10px 14px; border:2px solid var(--brand); border-radius:10px; display:inline-block; color:var(--brand); background:#f0f7ff
    }
    .question-scale{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .question-scale label{font-weight:500}
    .center{text-align:center}
    .hidden{display:none!important}
    .hr{height:1px; background:#e5e7eb; margin:14px 0}

    /* Scenario + Task Description styles */
    #scenarioDescription{
      background-color:#fff9e6;
      border-left:6px solid #f0ad4e;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
      padding:20px 25px;
      margin:16px 0;
      color:#333;
      line-height:1.6;
    }
    #scenarioDescription h2{margin:0 0 8px; color:#b45309}
    #scenarioDescription ul{margin:8px 0 0 18px}

    #taskDescription{
      background-color:#f9f9f9;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
      padding:20px 25px;
      margin:16px 0;
      line-height:1.6;
    }
    #taskDescription img#taskIllustration{
      display:block; margin:14px auto; max-width:100%; border:1px solid #e5e7eb; border-radius:8px;
    }
    #agentLegend{ text-align:center; margin-top:8px; color:#444 }
    #agentLegend img{ width:50px; vertical-align:middle; margin:0 10px }

    /* 7 ÁÇπÊùéÂÖãÁâπÈáèË°®Ôºö‰∏äÈù¢‰∏ÄÊéí radioÔºå‰∏ãÈù¢‰∏ÄÊéíÊñáÂ≠ó */
    .likert-7{
      display:grid;
      grid-template-columns:repeat(7, 1fr);
      grid-auto-rows:auto;
      gap:6px 12px;              /* Ë°åÈó¥Ë∑ù, ÂàóÈó¥Ë∑ù */
      align-items:center;        /* Á∫µÂêëÂ±Ö‰∏≠ radio */
      justify-items:center;      /* Ê®™ÂêëÂ±Ö‰∏≠ÊØèÂàóÂÜÖÂÆπ */
      margin-top:8px;
    }
    .likert-7 input[type="radio"]{
      margin:0;                  /* ÂéªÊéâÈªòËÆ§Â§ñËæπË∑ùÔºå‰øùËØÅÂÖâÊ†áÂØπÈΩê */
    }
    .likert-7 .scale-label{
      grid-row:2;                /* Áªü‰∏ÄÊîæÂú®Á¨¨‰∫åË°å */
      font-size:12px;
      color:#666;
      text-align:center;
      line-height:1.2;
    }
    /* Êó†ÈöúÁ¢çÔºöÊääÂèØËßÜ‰∏äÁöÑ label ÈöêËóèÔºå‰ΩÜ‰ªç‰øùÁïôÂèØËØªÊÄßÔºàÁªôÊØè‰∏™ radio ‰πü‰ºöÈÖç‰∏Ä‰∏™ aria-labelÔºâ*/
    .visually-hidden{
      position:absolute!important;
      width:1px;height:1px;
      margin:-1px;border:0;padding:0;
      clip:rect(0 0 0 0);overflow:hidden;
    }

  </style>
</head>

<body>
  <div class="container">
    <h1>Overcooked Human-AI Equilibrium Study</h1>

    <!-- Page 1: Prolific + Demographics -->
    <section id="page-intro" class="card">
      <h2>Basic Information</h2>
      <p class="muted">Please fill in the following, then continue.</p>
      <div class="row">
        <div class="col">
          <label for="prolificId">Prolific ID</label>
          <input id="prolificId" class="input" placeholder="Waiting for Prolific URL..." />
          <div id="pid-hint" style="font-size:12px; color:#16a34a; margin-top:4px; display:none;">
            ‚úì Auto-detected from Prolific
          </div>
        </div>
        <div class="col">
          <label for="age">Age</label>
          <input id="age" type="number" min="18" max="99" class="input" placeholder="e.g., 28" />
        </div>
        <div class="col">
          <label for="gender">Gender</label>
          <select id="gender" class="input">
            <option value="">Please select</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
            <option>Other</option>
          </select>
        </div>
      </div>
      <div class="inline" style="margin-top:12px">
        <button id="to-consent" class="btn" disabled>Next</button>
      </div>

      <script>
        (function() {
          //URL params
          function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
          }

          //PROLIFIC_PID
          const pid = getUrlParam('PROLIFIC_PID');
          const input = document.getElementById('prolificId');
          const hint = document.getElementById('pid-hint');

          if (pid) {
            // Found it - Auto-fill
            input.value = pid; 
            input.style.backgroundColor = "#f0fdf4";
            input.style.borderColor = "#16a34a";
            hint.style.display = "block";
            input.dispatchEvent(new Event('input', { bubbles: true }));
          } else {
            // Not found - manually
            input.placeholder = "e.g., 5f9c1d2e...";
          }
        })();
      </script>
    </section>

    <!-- Page 2: Consent -->
    <section id="page-consent" class="card hidden">
      <h2>Consent Form</h2>
      <div style="max-height:240px; overflow:auto; border:1px solid #e5e7eb; border-radius:12px; padding:14px; margin:12px 0">
        <p>This study is to understand how humans work with an AI agent to finish a collaborative game: Overcooked. </p>
        <p>The study is organized by researchers from Aalto University in Finland.</p>
        <p>This study aims to understand behavior and experience in human‚ÄìAI collaboration. Participation is voluntary and you may withdraw at any time. Data will be stored anonymously and used for research only. There are no known risks; if you feel uncomfortable, you may stop immediately.</p>
        <p>By checking the box and continuing, you indicate that you have read and agree to participate.</p>
      </div>
      <div class="inline">
        <input type="checkbox" id="consentCheck">
        <label for="consentCheck" style="margin:0">I have read and agree</label>
      </div>
      <div class="inline" style="margin-top:12px">
        <button id="to-instruction" class="btn" disabled>Continue</button>
      </div>
    </section>



    <!-- Page 3a: Instruction ‚Äì How to play + Practice -->
    <section id="page-instruction-1" class="card hidden">
      <div id="taskDescription">
        <h2>Welcome to the study!</h2>
        <p>Thank you for participating in this study!</p>
        <p>
          <strong>Your task is to finish a collaborative task:</strong> together with an AI teammate, complete as many dishes as possible within 45 seconds.<br>
          The target dish is a simple <em>lettuce salad</em>, with just 4 steps:
          <ol style="margin:8px 0 0 18px">
            <li>Pick up a lettuce,</li>
            <li>Chop it on the cutting board,</li>
            <li>Place the chopped lettuce onto a plate,</li>
            <li>Deliver the plate to the serving station.</li>
          </ol>
        </p>
        <img id="taskIllustration" src="static/images/task_illustration.png" alt="Task Illustration">
        <div id="agentLegend">
          You are <img src="static/images/agent-blue.png" alt="Agent Blue">
          &nbsp;&nbsp;&nbsp;&nbsp; Your robot partner is
          <img id="robotIcon" src="static/images/agent-robot.png" alt="Agent Robot">
          <!-- or 
          <img id="robotIcon" src="static/images/agent-robot2.png" alt="Agent Robot">
          or 
          <img id="robotIcon" src="static/images/agent-robot3.png" alt="Agent Robot">
          or 
          <img id="robotIcon" src="static/images/agent-robot4.png" alt="Agent Robot">-->
        </div>

        <!-- Kitchen item legend -->
        <div id="itemLegend" style="margin-top:14px;">
          <h3 style="margin:8px 0 6px; font-size:18px;">Kitchen Items</h3>
          <div style="
            display:grid; grid-template-columns:repeat(2, minmax(0,1fr));
            gap:10px; align-items:start; font-size:14px; color:#222;">
            
            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/counter.png" alt="Counter" style="width:36px;height:36px;">
              <div>
                <strong>Counter</strong><br>
                A surface to temporarily place items. <em>You can put vegetables or plates on counters.</em>
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/FreshLettuce.png" alt="Fresh Lettuce" style="width:36px;height:36px;">
              <div>
                <strong>Lettuce</strong><br>
                Pick it up and chop it before plating.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/plate.png" alt="Plate" style="width:36px;height:36px;">
              <div>
                <strong>Plate</strong><br>
                Place chopped lettuce on a plate; you can set plates on counters.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/cutboard.png" alt="Cutting Board" style="width:36px;height:36px;">
              <div>
                <strong>Cutting Board</strong><br>
                Chop lettuce here to make it ready for plating.
              </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;">
              <img src="static/images/delivery.png" alt="Delivery Station" style="width:36px;height:36px;">
              <div>
                <strong>Delivery Station</strong><br>
                Deliver the completed plate here to score.
              </div>
            </div>
          </div>

          <p style="margin-top:8px; color:#374151;">
            Tip: You may temporarily place <strong>vegetables or plates</strong> on any <strong>counter</strong> to organize your workflow.
          </p>
        </div>
        
        <p style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 18px; color: #222;">
          Use your arrow keys to play.
        </p>
        <div style="text-align:center; font-size:28px; margin-top:8px;">
          ‚¨ÜÔ∏è ‚¨áÔ∏è ‚¨ÖÔ∏è ‚û°Ô∏è
        </div>
      </div>

      <div style="margin-top:20px; text-align:center;">
        <div class="game-controls">
          <button id="btnTryPractice" class="btn">
            Try One Game (In this practice, your teammate won't move)
          </button>
        </div>
        <h3 style="font-size:14px; color:#555;">
           Please press arrow keys slowly to avoid network delay.
        </h3>
        <div class="game-viewport">
           <canvas id="gameCanvas_practice" width="600" height="600"></canvas>
        </div>
      </div>

      <p id="practiceHint" class="muted center" style="margin-top:8px">
        Practice score not enough. Finish more lettuce salad to proceed.
      </p>

      <div style="margin-top:20px; text-align:center;">
        <button id="to-instruction-2" class="btn" disabled>
          Proceed to Study Instruction
        </button>
      </div>
    </section>

    <!-- Page 3b: Study Instruction + Attention Check -->
    <section id="page-instruction-2a" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #2563eb; background-color: #eff6ff; padding: 20px; border-radius: 8px;">
        <h2 style="color:#1e3a8a; margin-top:0;">PART 1: The Goal - Work Smart, Not Hard</h2>
        <p>
          You are a chef in a busy kitchen. Unlike standard games, your goal is <strong>NOT just to be fast</strong>. 
          Your goal is to get a <span style="color:#2563eb; font-weight:bold;">High Efficiency Score</span>.
        </p>
        
        <div style="background:white; padding:15px; border-radius:8px; border:1px solid #dbeafe; margin:15px 0;">
          <h3 style="margin-top:0;">How Scoring Works:</h3>
          <ul style="line-height:1.8;">
            <li><span style="color:#16a34a; font-weight:bold;">(+) Team Revenue:</span> You gain points for every dish served.</li>
            <li><span style="color:#dc2626; font-weight:bold;">(-) Energy Cost:</span> You <span style="text-decoration:underline;">LOSE points for every step YOU take</span>.</li>
          </ul>
        </div>

        <p><strong>The Dilemma:</strong></p>
        <p>A "Hero" who runs around doing everything alone will get a <span style="color:#dc2626; font-weight:bold;">LOW score</span> because they wasted too much energy.</p>
        <p><strong>Winning Strategy:</strong> Coordinate to serve dishes while taking the fewest steps possible.</p>
      </div>

      <div class="card" style="margin-top:20px; border:1px solid #e5e7eb;">
        <h3>Comprehension Check 1/3</h3>
        
        <p style="margin-bottom:8px; font-weight:600;">1. To get a high score, I should:</p>
        <div id="quiz-q1">
          <label class="role-item">
            <input type="radio" name="q1" value="wrong"> 
            <span>Run fast and do everything myself.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q1" value="correct"> 
            <span>Serve dishes while minimizing my own movement.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q1" value="wrong"> 
            <span>Stand still and ignore the orders.</span>
          </label>
        </div>

        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px dashed #ccc;">
            <p style="margin-bottom:8px; font-weight:600;">
                2. To show you are reading, please select the option below that would result in a low score (The opposite of what you want).
            </p>
            <div id="quiz-q1-attention">
            <label class="role-item">
                <input type="radio" name="q1_att" value="wrong"> 
                <span>Collaborate efficiently with the AI.</span>
            </label>
            <label class="role-item">
                <input type="radio" name="q1_att" value="correct"> 
                <span>Run around in circles wasting energy.</span> 
                </label>
            <label class="role-item">
                <input type="radio" name="q1_att" value="wrong"> 
                <span>Serve salads with few steps.</span>
            </label>
            </div>
        </div>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="btn-next-2a" class="btn btn-primary">Next Section</button>
      </div>
    </section>

    <section id="page-instruction-2b" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #8b5cf6; background-color: #f5f3ff; padding: 20px; border-radius: 8px;">
        <h2 style="color:#5b21b6; margin-top:0;">PART 2: The Study Structure (7 + 7)</h2>
        <p>
          You will play a total of <strong>14 Rounds</strong>. The experiment is divided into two distinct phases to test how the AI learns from you.
        </p>
        
        <div style="margin-top:15px; margin-bottom:15px;">
          <div style="background:white; padding:15px; border-radius:8px; border:2px solid #ddd6fe; margin-bottom:10px;">
            <strong style="color:#7c3aed;">Phase 1: Observation (Rounds 1-7)</strong><br>
            The AI is <strong>watching you</strong>. It records your decisions (e.g., do you prefer chopping or plating?).<br>
            <em style="color:#666;">Your Job: Play naturally and consistently so it can learn your style.</em>
          </div>

          <div style="background:white; padding:15px; border-radius:8px; border:2px solid #ddd6fe;">
            <strong style="color:#7c3aed;">Phase 2: Adaptation (Rounds 8-14)</strong><br>
            After Round 7, the AI will <strong>update itself</strong> based on what it learned about you.<br>
            <em style="color:#666;">Your Job: Notice how the AI has changed and use its new efficiency to boost your score.</em>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:20px;">
        <h3>Comprehension Check 2/3</h3>
        
        <p style="margin-bottom:8px; font-weight:600;">1. What happens after Round 7?</p>
        <div id="quiz-q2a">
          <label class="role-item">
            <input type="radio" name="q2a" value="wrong"> 
            <span>The game ends immediately.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2a" value="correct"> 
            <span>The AI updates itself to adapt to my style.</span>
          </label>
        </div>

        <p style="margin-top:20px; margin-bottom:8px; font-weight:600;">2. Why is the AI observing you in Phase 1?</p>
        <div id="quiz-q2b">
          <label class="role-item">
            <input type="radio" name="q2b" value="wrong"> 
            <span>To judge if I am a good cook.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2b" value="correct"> 
            <span>To learn my habits and match me better in Phase 2.</span>
          </label>
          <label class="role-item">
            <input type="radio" name="q2b" value="wrong"> 
            <span>It is not observing me; it ignores me.</span>
          </label>
        </div>
      </div>

      <div class="center" style="margin-top:20px;">
        <button id="btn-next-2b" class="btn btn-primary">Next Section</button>
      </div>
    </section>

    <section id="page-instruction-2c" class="card hidden">
      <div id="scenarioDescription" style="border-left: 6px solid #f59e0b; background-color: #fffbeb; padding: 20px; border-radius: 8px;">
        <h2 style="color:#92400e; margin-top:0;">PART 3: Your Strategy - Find Your Equilibrium</h2>
        <p>
          There is no single "correct" role to play. Your goal is to find the strategy that feels most efficient for <strong>you</strong>.
        </p>
        
        <ul style="line-height:1.7;">
          <li><strong>Phase 1: Play Naturally.</strong> Don't feel forced to stick to a rigid role if it feels inefficient. Play in a way that balances speed and energy costs naturally. The AI needs to observe your <em>real</em> style to learn effectively.</li>
          <li><strong>Phase 2: Find Your Flow.</strong> When the AI updates, it might behave differently. Don't be afraid to adjust your behavior to match it. Your goal is to settle into a rhythm‚Äîan <strong>equilibrium</strong>‚Äîwhere you both work smoothly together.</li>
          <li><strong>You Decide the Balance:</strong> Always remember the cost of movement. You have to make the choice: <em>"Is it worth running to get that plate, or should I wait for the AI?"</em> Find the balance that maximizes your own score.</li>
        </ul>
      </div>

        <div class="card" style="margin-top:20px;">
          <h3>Final Check 3/3</h3>

          <p style="margin-bottom:8px; font-weight:600;">1. How should you play in Phase 1?</p>
          <div id="quiz-q3a">
            <label class="role-item">
              <input type="radio" name="q3a" value="wrong"> 
              <span>I must force myself to do one specific task only.</span>
            </label>
            <label class="role-item">
              <input type="radio" name="q3a" value="correct"> 
              <span>I should play naturally so the AI learns my real style.</span>
            </label>
          </div>

          <p style="margin-top:20px; margin-bottom:8px; font-weight:600;">2. To show you are reading, select "Always do nothing".</p>
          <div id="quiz-q3b">
            <label class="role-item"><input type="radio" name="q3b" value="wrong"> Find equilibrium</label>
            <label class="role-item"><input type="radio" name="q3b" value="correct"> Always do nothing</label>
            <label class="role-item"><input type="radio" name="q3b" value="wrong"> Run around randomly</label>
          </div>
        </div>

        <div class="center" style="margin-top:20px;">
          <button id="start-task-1" class="btn success" style="font-size:18px; padding:15px 30px;">
            I'm Ready - Start Phase 1
          </button>
        </div>
    </section>

    <!--Phase 1-->
    <section id="page-phase-1" class="card hidden">
      <h2 style="color:#2563eb; text-align:center;">Phase 1: Observation</h2>
      <p class="muted" style="text-align:center;">The AI is learning your play style. Play naturally!</p>
      
      <div style="display:flex; justify-content:center; gap:20px; margin:20px 0;">
        <div class="pill">
          <span>Phase <strong id="currentPhase">1</strong></span>
        </div>
        <div class="pill">
          <span>Round <strong id="currentRound">1 / 7</strong></span>
        </div>
        
        <div class="pill">
          <span>Time: <strong id="stepsLeft" style="color:#2563eb;">0:45</strong></span>
        </div>
        
        <div class="pill" style="background:#f0fdf4; color:#15803d;">
          <span>Score: <strong id="currentScore">0</strong></span>
        </div>
      </div>
      
      <div class="game-viewport" style="position: relative;">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <div id="round-overlay" class="hidden" style="
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255, 255, 255, 0.95); 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            z-index: 50; transition: opacity 0.5s ease;
            border-radius: 8px;">
            
            <h1 id="overlay-title" style="color: #2563eb; font-size: 40px; margin: 0; text-transform: uppercase; letter-spacing: 2px;">
              Round 1 Complete
            </h1>
            <p id="overlay-subtitle" style="color: #666; font-size: 20px; margin-top: 10px; font-weight: bold;">
              Next round starting...
            </p>
        </div>
      </div>
    </section>

    <section id="page-mid-questionnaire" class="container hidden" style="max-width: 800px; margin: 40px auto;">
      <div class="card">
        
        <div style="text-align: center; margin-bottom: 40px;">
          <h1 style="color:#2563eb; margin-bottom: 5px;">Phase 1 Complete!</h1>
          <p class="muted">Here is a summary of your performance with the Phase 1 AI.</p>

          <div style="margin: 20px 0; overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse; text-align: center;">
              <thead>
                <tr style="background: #eff6ff; color: #1e3a8a;">
                  <th style="padding: 12px;">Round</th>
                  <th style="padding: 12px;">Score</th>
                  <th style="padding: 12px;">Dishes</th>
                  <th style="padding: 12px;">Your Steps</th>
                </tr>
              </thead>
              <tbody id="summary-table-body">
                </tbody>
            </table>
          </div>
        </div>

        <hr style="border: 0; border-top: 2px dashed #e5e7eb; margin: 40px 0;">

        <div>
          <h2 style="color:#1e3a8a; text-align: center; margin-bottom: 20px;">Partner Evaluation</h2>
          <p class="muted text-center" style="margin-bottom: 30px;">Based on the performance above, please rate your experience.</p>

          <div style="margin-bottom:25px; padding:20px; background:#f9fafb; border-radius:8px;">
            <p style="font-weight:bold; margin-bottom:8px;">1. Mental Effort (Cognitive Load)</p>
            <p style="font-size:14px; color:#666; margin-bottom:15px;">How much mental effort was required to coordinate with this partner?</p>
            <div class="likert-7" style="display:flex; justify-content:space-between;">
              <label><input type="radio" name="mid_load" value="1"> 1<br><span style="font-size:10px">Very Low</span></label>
              <label><input type="radio" name="mid_load" value="2"> 2</label>
              <label><input type="radio" name="mid_load" value="3"> 3</label>
              <label><input type="radio" name="mid_load" value="4"> 4</label>
              <label><input type="radio" name="mid_load" value="5"> 5</label>
              <label><input type="radio" name="mid_load" value="6"> 6</label>
              <label><input type="radio" name="mid_load" value="7"> 7<br><span style="font-size:10px">Very High</span></label>
            </div>
          </div>

          <div style="margin-bottom:25px; padding:20px; background:#f9fafb; border-radius:8px;">
            <p style="font-weight:bold; margin-bottom:8px;">2. Cooperation & Flow</p>
            <p style="font-size:14px; color:#666; margin-bottom:15px;">How well did you and the AI work together as a team?</p>
            <div class="likert-7" style="display:flex; justify-content:space-between;">
              <label><input type="radio" name="mid_collab" value="1"> 1<br><span style="font-size:10px">Poorly</span></label>
              <label><input type="radio" name="mid_collab" value="2"> 2</label>
              <label><input type="radio" name="mid_collab" value="3"> 3</label>
              <label><input type="radio" name="mid_collab" value="4"> 4</label>
              <label><input type="radio" name="mid_collab" value="5"> 5</label>
              <label><input type="radio" name="mid_collab" value="6"> 6</label>
              <label><input type="radio" name="mid_collab" value="7"> 7<br><span style="font-size:10px">Perfectly</span></label>
            </div>
          </div>

          <div style="margin-bottom:25px; padding:20px; background:#f9fafb; border-radius:8px;">
            <p style="font-weight:bold; margin-bottom:8px;">3. Role Strategy</p>
            <p style="font-size:14px; color:#666; margin-bottom:15px;">Who did most of the work?</p>
            <div class="likert-7" style="display:flex; justify-content:space-between;">
              <label><input type="radio" name="mid_strategy" value="1"> 1<br><span style="font-size:10px">Me (Hero)</span></label>
              <label><input type="radio" name="mid_strategy" value="2"> 2</label>
              <label><input type="radio" name="mid_strategy" value="3"> 3</label>
              <label><input type="radio" name="mid_strategy" value="4"> 4<br><span style="font-size:10px">Balanced</span></label>
              <label><input type="radio" name="mid_strategy" value="5"> 5</label>
              <label><input type="radio" name="mid_strategy" value="6"> 6</label>
              <label><input type="radio" name="mid_strategy" value="7"> 7<br><span style="font-size:10px">AI (Lazy)</span></label>
            </div>
          </div>

          <div style="margin-bottom:25px; padding:20px; background:#f9fafb; border-radius:8px;">
            <p style="font-weight:bold; margin-bottom:8px;">4. Predictability</p>
            <p style="font-size:14px; color:#666; margin-bottom:15px;">Was it easy to predict what the AI was going to do?</p>
            <div class="likert-7" style="display:flex; justify-content:space-between;">
              <label><input type="radio" name="mid_predict" value="1"> 1<br><span style="font-size:10px">Impossible</span></label>
              <label><input type="radio" name="mid_predict" value="2"> 2</label>
              <label><input type="radio" name="mid_predict" value="3"> 3</label>
              <label><input type="radio" name="mid_predict" value="4"> 4</label>
              <label><input type="radio" name="mid_predict" value="5"> 5</label>
              <label><input type="radio" name="mid_predict" value="6"> 6</label>
              <label><input type="radio" name="mid_predict" value="7"> 7<br><span style="font-size:10px">Very Easy</span></label>
            </div>
          </div>

          <div class="center" style="margin-top:40px;">
            <button id="btn-submit-mid-survey" class="btn btn-primary" style="font-size:18px; padding:12px 35px;">
              Submit & Start Phase 2
            </button>
          </div>
        </div>
      </div>
    </section>

    <section id="page-phase2-intro" class="card hidden" style="text-align:center; padding:40px;">
      <h1 style="color:#7c3aed; margin-top:0;">Phase 2: Adaptation</h1>
      
      <div style="background-color:#f5f3ff; border:2px solid #ddd6fe; border-radius:10px; padding:20px; max-width:600px; margin:20px auto;">
        <div style="font-size:48px; margin-bottom:10px;">ü§ñ‚ú®</div>
        <h3 style="color:#5b21b6; margin:0 0 10px 0;">AI Partner Updated</h3>
        <p style="font-size:18px; line-height:1.6; color:#4c1d95; margin:0;">
          The AI has analyzed your play style during Phase 1.<br>
          It has now <strong>adapted its strategy</strong> to work better with you.
        </p>
        <p style="margin-top:15px; font-weight:bold;">Goal: Find your new "Flow" with this updated partner.</p>
      </div>

      <button id="btn-start-phase2" class="btn success" style="font-size:22px; padding:15px 40px; margin-top:20px;">
        Start Phase 2
      </button>
    </section>

  <section id="page-phase-2" class="card hidden">
    <h2 style="color:#16a34a; text-align:center;">Phase 2: Adaptation</h2>
    <p class="muted" style="text-align:center;">The AI has updated. Notice the changes!</p>
    
    <div style="display:flex; justify-content:center; gap:20px; margin:20px 0;">
      <div class="pill" style="background:#f0fdf4; color:#15803d;">
        <span>Phase <strong>2</strong></span>
      </div>
      <div class="pill">
        <span>Round <strong id="currentRound">1 / 7</strong></span>
      </div>
      <div class="pill">
        <span>Steps Left: <strong id="stepsLeft">200</strong></span>
      </div>
      <div class="pill" style="background:#f0fdf4; color:#15803d;">
        <span>Score: <strong id="currentScore">0</strong></span>
      </div>
    </div>
  
    <div class="game-viewport">
      <canvas id="gameCanvas" width="600" height="600"></canvas>
    </div>
  
    <!-- Reuse the same round-end-panel as Phase 1 -->
    <div id="round-end-panel" class="hidden" style="background:#f0fdf4; border:2px solid #22c55e; border-radius:12px; padding:25px; margin-top:20px; text-align:center;">
      <h3 style="color:#15803d; margin:0 0 15px 0;">Round Complete! üéâ</h3>
      <div style="display:flex; justify-content:center; gap:30px; margin-bottom:20px;">
        <div>
          <p style="margin:0; color:#666; font-size:14px;">Team Score</p>
          <p style="margin:5px 0 0 0; font-size:32px; font-weight:bold; color:#15803d;" id="round-score">0</p>
        </div>
        <div>
          <p style="margin:0; color:#666; font-size:14px;">Your Steps</p>
          <p style="margin:5px 0 0 0; font-size:32px; font-weight:bold; color:#7c3aed;" id="round-steps">0</p>
        </div>
      </div>
      <p style="color:#16a34a; font-weight:600; margin-bottom:15px;">Excellent work! üåü</p>
      <button id="btn-next-round" class="btn success">Next Round</button>
    </div>
  </section>

  <!-- Questionnaire Phase 2-->
  <section id="page-phase-2-qs" class="card hidden" style="max-width:700px; margin:40px auto;">
    <h2 style="color:#2563eb; margin-top:0;">Phase 2 Complete - Final Questions</h2>
    <p class="muted">Please rate your experience during Phase 2.</p>
    <div class="hr"></div>

    <div style="margin-bottom:30px;">
      <p style="font-weight:bold; margin-bottom:12px;">
        1. How mentally demanding was it to play with the AI partner in Phase 2?
      </p>
      <p style="font-size:13px; color:#666; margin-bottom:10px;">
        (1 = Very Easy, 7 = Very Demanding)
      </p>
      <div class="likert-7">
        <input type="radio" name="p2_cognitive" value="1" aria-label="1 - Very Easy" />
        <input type="radio" name="p2_cognitive" value="2" aria-label="2" />
        <input type="radio" name="p2_cognitive" value="3" aria-label="3" />
        <input type="radio" name="p2_cognitive" value="4" aria-label="4 - Neutral" />
        <input type="radio" name="p2_cognitive" value="5" aria-label="5" />
        <input type="radio" name="p2_cognitive" value="6" aria-label="6" />
        <input type="radio" name="p2_cognitive" value="7" aria-label="7 - Very Demanding" />
        
        <span class="scale-label">Very Easy</span>
        <span class="scale-label"></span>
        <span class="scale-label"></span>
        <span class="scale-label">Neutral</span>
        <span class="scale-label"></span>
        <span class="scale-label"></span>
        <span class="scale-label">Very Demanding</span>
      </div>
    </div>

    <div style="margin-bottom:30px;">
      <p style="font-weight:bold; margin-bottom:12px;">
        2. How well did you and the AI collaborate as a team in Phase 2?
      </p>
      <p style="font-size:13px; color:#666; margin-bottom:10px;">
        (1 = Very Poorly, 7 = Excellent)
      </p>
      <div class="likert-7">
        <input type="radio" name="p2_collab" value="1" aria-label="1 - Very Poorly" />
        <input type="radio" name="p2_collab" value="2" aria-label="2" />
        <input type="radio" name="p2_collab" value="3" aria-label="3" />
        <input type="radio" name="p2_collab" value="4" aria-label="4 - Neutral" />
        <input type="radio" name="p2_collab" value="5" aria-label="5" />
        <input type="radio" name="p2_collab" value="6" aria-label="6" />
        <input type="radio" name="p2_collab" value="7" aria-label="7 - Excellent" />
        
        <span class="scale-label">Very Poorly</span>
        <span class="scale-label"></span>
        <span class="scale-label"></span>
        <span class="scale-label">Neutral</span>
        <span class="scale-label"></span>
        <span class="scale-label"></span>
        <span class="scale-label">Excellent</span>
      </div>
    </div>

    <div class="hr"></div>

    <div style="margin-bottom:30px;">
      <p style="font-weight:bold; margin-bottom:12px;">
        3. (Optional) Any additional feedback about your experience?
      </p>
      <textarea id="final-feedback" rows="4" style="width:100%; padding:12px; border:1px solid #cbd5e1; border-radius:6px;" placeholder="Feel free to share any thoughts..."></textarea>
    </div>

    <div class="center" style="margin-top:40px;">
      <button id="btn-phase2-qs-submit" class="btn success" style="font-size:20px; padding:12px 40px;">
        Submit & Finish
      </button>
    </div>
  </section>


  <section id="page-end" class="card hidden center" style="padding: 60px 20px;">
    <div style="font-size:64px; margin-bottom: 20px;">üéâ</div>
    <h2 style="color:#16a34a; font-size: 32px; margin-top:0;">Experiment Complete!</h2>
    <p style="font-size: 18px; color: #4b5563; max-width: 500px; margin: 0 auto 30px auto;">
        Thank you for your participation. Your data has been successfully recorded for our study on Human-AI Collaboration.
    </p>
    
    <div id="completionCodeWrap" class="hidden" style="margin-top:20px; padding:25px; background:#f0fdf4; border:2px solid #22c55e; border-radius:12px; max-width: 400px; margin-left: auto; margin-right: auto;">
        <p style="margin:0; color:#15803d; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; font-size: 14px;">
            Your Completion Code:
        </p>
        <p id="completionCode" style="font-family: monospace; font-weight:700; font-size:32px; margin:10px 0; color: #14532d;"></p>
        <p style="font-size: 13px; color: #16a34a; margin-top: 10px;">
            Please copy this code and paste it back into Prolific/MTurk.
        </p>
    </div>

    <div style="margin-top: 40px;">
        <p class="muted" style="font-style: italic;">You may now close this window.</p>
    </div>
  </section>
  </div>

  <script src="static/js/config.js"></script>
  <script src="static/js/view.js"></script>
  <script src="static/js/controller.js"></script>
  <script src="static/js/practice.js"></script>
  <!-- <script src="static/js/equilibriumstudy_freeplay_4models_2rounds_samemap.js"></script> -->
</body>
</html>
